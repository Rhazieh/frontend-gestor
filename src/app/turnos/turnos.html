<!-- src/app/turnos/turnos.html
     Vista/template del componente Turnos.
     Ac√° se muestra: filtros, grilla de turnos, formulario de alta y formulario de edici√≥n.
     Usa binding bidireccional [(ngModel)], directivas *ngFor/*ngIf y eventos (click), (ngSubmit).
-->

<!-- ===================== FILTROS ===================== -->
<!-- Filtro por fecha: bindea con [(ngModel)] a la propiedad filtroFecha (string 'YYYY-MM-DD') -->
<label>
  Filtrar por fecha:
  <input type="date" [(ngModel)]="filtroFecha" name="filtroFecha" />
</label>

<!-- Filtro por paciente: bindea con [(ngModel)] a filtroPacienteId (number|null).
     La opci√≥n "Todos" manda null. El listado se arma con *ngFor sobre pacientes. -->
<label>
  Filtrar por paciente:
  <select [(ngModel)]="filtroPacienteId" name="filtroPacienteId">
    <option [ngValue]="null">-- Todos --</option>
    <option *ngFor="let paciente of pacientes" [ngValue]="paciente.id">
      {{ paciente.nombre }} (ID: {{ paciente.id }})
    </option>
  </select>
</label>
<br />

<!-- ===================== LISTA / GRILLA ===================== -->
<h2>Lista de Turnos</h2>

<!-- Tabla simple que recorre turnosFiltrados (getter en el componente) -->
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Fecha</th>
      <th>Hora</th>
      <th>Raz√≥n</th>
      <th>Paciente</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <!-- *ngFor crea una fila por cada turno -->
    <tr *ngFor="let turno of turnosFiltrados">
      <td>{{ turno.id }}</td>
      <!-- getFechaFormateada evita problemas de timezone y muestra DD/MM/YYYY -->
      <td>{{ getFechaFormateada(turno.fecha) }}</td>
      <td>{{ turno.hora }}</td>
      <td>{{ turno.razon }}</td>
      <td>{{ turno.paciente?.nombre || 'Sin asignar' }}</td>
      <td>
        <!-- Eventos (click) llaman a m√©todos del componente -->
        <button (click)="editarTurno(turno)">Editar</button>
        <button class="eliminar" (click)="eliminarTurno(turno.id)">Eliminar</button>
      </td>
    </tr>
  </tbody>
</table>

<hr />

<!-- ===================== FORMULARIO: CREAR ===================== -->
<h3>Crear Turno</h3>

<!-- (ngSubmit) dispara crearTurno().
     #formTurno es una referencia local al formulario (por si quisieras leer estado).
     novalidate: desactiva validaci√≥n HTML nativa; validamos manualmente en TS. -->
<form (ngSubmit)="crearTurno()" #formTurno="ngForm" novalidate>
  <label>
    Fecha:
    <!-- [(ngModel)] hace two-way binding con nuevoTurno.fecha -->
    <input
      type="date"
      [(ngModel)]="nuevoTurno.fecha"
      name="fecha"
      required
      max="2050-12-31"
    />
    <!-- Muestra error si existe errores.fecha y el user intent√≥ enviar -->
    <small class="error" *ngIf="errores.fecha && intentoEnviar">{{ errores.fecha }}</small>
  </label>
  <br />
  <label>
    Hora:
    <input
      type="time"
      [(ngModel)]="nuevoTurno.hora"
      name="hora"
      required
    />
    <small class="error" *ngIf="errores.hora && intentoEnviar">{{ errores.hora }}</small>
  </label>
  <br />
  <label>
    Raz√≥n:
    <input
      type="text"
      [(ngModel)]="nuevoTurno.razon"
      name="razon"
      required
    />
    <small class="error" *ngIf="errores.razon && intentoEnviar">{{ errores.razon }}</small>
  </label>
  <br />
  <label>
    Paciente:
    <!-- El select guarda directamente el id num√©rico del paciente en nuevoTurno.pacienteId -->
    <select
      [(ngModel)]="nuevoTurno.pacienteId"
      name="pacienteId"
      required
    >
      <!-- Opci√≥n placeholder deshabilitada -->
      <option [ngValue]="null" disabled selected>
        -- Seleccionar paciente --
      </option>
      <!-- Opciones generadas desde this.pacientes -->
      <option
        *ngFor="let paciente of pacientes"
        [ngValue]="paciente.id"
      >
        {{ paciente.nombre }}
      </option>
    </select>
    <small class="error" *ngIf="errores.pacienteId && intentoEnviar">{{ errores.pacienteId }}</small>
  </label>
  <br />
  <button type="submit">Crear Turno</button>
</form>

<hr />

<!-- ===================== FORMULARIO: EDITAR ===================== -->
<h3>Editar Turno</h3>

<!-- Solo se muestra si turnoEditando != null -->
<form *ngIf="turnoEditando" (ngSubmit)="guardarEdicion()" #formEdit="ngForm" novalidate>
  <label>
    Fecha:
    <!-- Fecha deshabilitada en edici√≥n (pol√≠tica actual del UI).
         Sigue bindeada para mostrar el valor. -->
    <input
      type="date"
      [(ngModel)]="turnoEditando.fecha"
      name="editFecha"
      disabled
    />
    <small class="error" *ngIf="erroresEdicion.fecha">{{ erroresEdicion.fecha }}</small>
  </label>
  <br />
  <label>
    Hora:
    <input
      type="time"
      [(ngModel)]="turnoEditando.hora"
      name="editHora"
      required
    />
    <small class="error" *ngIf="erroresEdicion.hora">{{ erroresEdicion.hora }}</small>
  </label>
  <br />
  <label>
    Raz√≥n:
    <input
      type="text"
      [(ngModel)]="turnoEditando.razon"
      name="editRazon"
      required
    />
    <small class="error" *ngIf="erroresEdicion.razon">{{ erroresEdicion.razon }}</small>
  </label>
  <br />
  <label>
    Paciente:
    <!-- Combo deshabilitado en edici√≥n (mantener paciente).
         Se muestra el nombre actual. -->
    <select
      [(ngModel)]="turnoEditando.paciente.id"
      name="editPacienteId"
      disabled
    >
      <option
        *ngFor="let paciente of pacientes"
        [ngValue]="paciente.id"
      >
        {{ paciente.nombre }}
      </option>
    </select>
  </label>
  <br />
  <button type="submit">Guardar Cambios</button>
  <button type="button" (click)="cancelarEdicion()">Cancelar</button>
</form>

<!--
  üìå Siguiente archivo recomendado para seguir:
    1) "src/app/turnos/turnos.service.ts" (servicio HTTP usado por este template)
    2) Luego "src/app/pacientes/pacientes.service.ts" y "src/app/pacientes/pacientes.html"
-->
```Ó®Å0Ó®Ç